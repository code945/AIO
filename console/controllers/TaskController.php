<?php
/**
 * User: hongxu.lin
 * Date: 5/13/2016
 * Time: 6:30 PM
 */


namespace console\controllers;

use backend\models\Admin;
use common\models\Category;
use common\models\Post;
use common\models\PostTag;
use common\models\Tag;

class TaskController extends \yii\console\Controller
{ 
    public function actionGetcommets()
    {
        echo "Getcommets...\n";
        $allIds = (new \yii\db\Query())
               ->select(['ids'=>' GROUP_CONCAT(cast(`id` as char(10)) SEPARATOR \',\') '])
               ->from('post')
               ->one();
        $ids = $allIds['ids'];
        echo "get ids from db:\n".$ids;
        $url='http://api.duoshuo.com/threads/counts.json?short_name=linhongxu&threads='.$ids;
        echo "send url:\n".$url;
        $json = file_get_contents($url);
        //$json = '{"response":{"7":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"7"},"13":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"13"},"14":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"14"},"22":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"22"},"23":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"23"},"26":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"26"},"30":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"30"},"35":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"35"},"39":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"39"},"44":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"44"},"45":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"45"},"47":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"47"},"48":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"48"},"50":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"50"},"51":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"51"},"54":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"54"},"57":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"57"},"59":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"59"},"67":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"67"},"68":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"68"},"72":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"72"},"73":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"73"},"84":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"84"},"96":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"96"},"99":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"99"},"100":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"100"},"107":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"107"},"110":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"110"},"119":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"119"},"121":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"121"},"123":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"123"},"125":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"125"},"126":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"126"},"127":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"127"},"128":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"128"},"132":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"132"},"141":{"thread_id":"6293437725831856898","channel_key":null,"thread_key":"141","reposts":0,"views":0,"likes":0,"dislikes":0,"comments":0},"143":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"143"},"153":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"153"},"158":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"158"},"160":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"160"},"162":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"162"},"163":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"163"},"165":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"165"},"169":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"169"},"171":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"171"},"180":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"180"},"181":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"181"},"187":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"187"},"188":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"188"},"3":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"3"},"5":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"5"},"6":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"6"},"11":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"11"},"17":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"17"},"18":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"18"},"19":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"19"},"28":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"28"},"31":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"31"},"43":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"43"},"66":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"66"},"70":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"70"},"71":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"71"},"78":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"78"},"79":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"79"},"80":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"80"},"81":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"81"},"87":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"87"},"102":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"102"},"112":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"112"},"114":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"114"},"118":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"118"},"122":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"122"},"129":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"129"},"133":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"133"},"136":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"136"},"142":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"142"},"145":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"145"},"146":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"146"},"147":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"147"},"150":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"150"},"154":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"154"},"159":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"159"},"161":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"161"},"166":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"166"},"168":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"168"},"170":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"170"},"172":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"172"},"175":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"175"},"176":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"176"},"177":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"177"},"179":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"179"},"182":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"182"},"183":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"183"},"193":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"193"},"195":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"195"},"200":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"200"},"8":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"8"},"12":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"12"},"15":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"15"},"16":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"16"},"20":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"20"},"21":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"21"},"34":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"34"},"36":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"36"},"40":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"40"},"46":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"46"},"53":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"53"},"55":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"55"},"56":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"56"},"58":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"58"},"60":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"60"},"61":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"61"},"62":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"62"},"63":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"63"},"76":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"76"},"86":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"86"},"94":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"94"},"97":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"97"},"101":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"101"},"104":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"104"},"106":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"106"},"116":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"116"},"117":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"117"},"130":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"130"},"131":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"131"},"135":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"135"},"137":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"137"},"139":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"139"},"144":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"144"},"151":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"151"},"152":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"152"},"155":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"155"},"157":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"157"},"164":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"164"},"186":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"186"},"189":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"189"},"192":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"192"},"194":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"194"},"1":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"1"},"2":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"2"},"9":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"9"},"10":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"10"},"24":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"24"},"27":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"27"},"29":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"29"},"32":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"32"},"41":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"41"},"42":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"42"},"49":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"49"},"65":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"65"},"74":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"74"},"75":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"75"},"77":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"77"},"83":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"83"},"85":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"85"},"88":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"88"},"91":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"91"},"93":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"93"},"95":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"95"},"103":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"103"},"105":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"105"},"108":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"108"},"109":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"109"},"111":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"111"},"115":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"115"},"124":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"124"},"134":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"134"},"138":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"138"},"173":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"173"},"178":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"178"},"184":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"184"},"185":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"185"},"191":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"191"},"4":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"4"},"25":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"25"},"33":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"33"},"37":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"37"},"38":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"38"},"52":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"52"},"64":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"64"},"69":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"69"},"82":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"82"},"89":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"89"},"90":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"90"},"92":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"92"},"98":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"98"},"113":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"113"},"120":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"120"},"140":{"thread_id":"6293410773804778242","channel_key":null,"thread_key":"140","reposts":0,"views":0,"likes":0,"dislikes":0,"comments":1},"148":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"148"},"149":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"149"},"156":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"156"},"167":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"167"},"174":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"174"},"190":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"190"},"196":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"196"},"197":{"thread_id":"6293433251457401601","channel_key":null,"thread_key":"197","reposts":0,"views":0,"likes":0,"dislikes":0,"comments":0},"198":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"198"},"199":{"likes":0,"dislikes":0,"comments":0,"reposts":0,"views":0,"channel_key":"","thread_key":"199"}},"options":{"comments_zero":"暂无评论","comments_one":"1条评论","comments_multiple":"{num}条评论"},"code":0}';
        $array = json_decode($json);
        $connection = \Yii::$app->db;
        if( $array->code == 0)
        {
            $sql = "UPDATE post SET comments_count = CASE id ";
            foreach ($array->response as $id => $data) {
                $sql .= sprintf("WHEN %d THEN %d ", $id, $data->comments);
            }
            $sql .= "END WHERE id IN ($ids)";
            echo $sql;
        }
        $transaction = Tag::getDb()->beginTransaction();
        try {
            $connection->createCommand($sql)->execute();
            $transaction->commit();
            echo "transaction commited  ...\n";
        } catch(\Exception $e) {
            $transaction->rollBack();
            echo $e;
            echo "transaction commited  failed,rollback ...\n";
        }
    }




}